---
title: "Donor Perception Survey [Regression Analysis]"
author: "Jan Karregat"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
Sys.setlocale("LC_MESSAGES", 'en_GB.UTF-8')
Sys.setenv(LANG = "en_US.UTF-8")
# echo "rmarkdown::render('ferritin_stats_FIN.Rmd', clean=TRUE,output_format='pdf_document',output_file='../results/ferritin_stats_FIN.pdf')" | R --slave
knitr::opts_chunk$set(
        echo = TRUE,
        message = FALSE,
        warning = FALSE
)

currentDate <- format(Sys.time(), "%Y-%m-%d")
FolderName <- paste("L:/DonorMedicin/FORTE/B Donor Perception Survey/B Analysis/R/3. Plots/", currentDate,sep="")
dir.create(FolderName)


library(plyr)
library(nFactors)
library(psych)
library(corrplot)
library(psych)
#library("ggpubr")
library(ggplot2)
library(tidyverse)
library(ggthemes)
library(haven)
library(rsample)
library(broom)
library(scales)
library(kableExtra)
library(boot)
#library(tableone)
library(naniar)
library(haven)
library(foreign)
#library(mice)
library(tidyverse)
library(tableone)
library(stargazer)
library(gridExtra)
library(cowplot)
library(broom)
library(GGally)
library(ggfortify)
library(knitr)
library(lubridate)
library(car)
library(reshape2)
library(sfsmisc)
library(MASS)
library(ordinal)
library(sjmisc)
library(VIM)
library(epiDisplay)
library(epitools)
library(ez)
library(ggbeeswarm)
library(ggthemes)
library(rsample)
library(broom)
library(scales)
library(kableExtra)
library(boot)
library(readxl)
library(foreign)
library(corrr)
library(ggcorrplot)
library(tidylog, warn.conflicts = F)
```

# Regression dataset

```{r}
# Open dataset with regression data
DPS_Regression <- readRDS("L:/DonorMedicin/FORTE/B Donor Perception Survey/B Analysis/R/2. Datasets/3. DPS - Regression Data")

Regression <- DPS_Regression
```

# Adjust dataset for linear regression
```{r}
Regression1 <- Regression

# Change unknown to missing
Regression1[Regression1 == "Unknown"] <- NA

# Check number of missings
colSums(is.na(Regression1))
#md.pattern(Regression1)

# Change order of DonorCareer valuesRegression1
Regression1$DonorCareer <- factor(Regression$DonorCareer, levels=c('New','Beginner','Experienced'))

# Scale knowledge variables 0 - 10
# Rescale the knowledge variables
Regression1$KnowledgeIronSupplements <- scales::rescale(Regression1$KnowledgeIronSupplements, to=c(0,10))
Regression1$KnowledgeIronMetabolism <- scales::rescale(Regression1$KnowledgeIronMetabolism, to=c(0,10))
Regression1$KnowledgePolicy <- scales::rescale(Regression1$KnowledgePolicy, to=c(0,10))
Regression1$KnowledgeDonation <- scales::rescale(Regression1$KnowledgeDonation, to=c(0,10))

# Recode variables
Regression1[sapply(Regression1, is.character)] <- lapply(Regression1[sapply(Regression1, is.character)], 
                                       as.factor)

Regression1$Deferral <- gsub("Deferred once", "Once", Regression1$Deferral)
Regression1$Deferral <- gsub("Deferred multiple times", "More than once", Regression1$Deferral)
Regression1$Deferral <- gsub("Never deferred", "Never", Regression1$Deferral)

Regression1$Education <- factor(Regression1$Education, levels=c('Low','Middle','High'))
Regression1$Health <- factor(Regression1$Health, levels=c('Mediocre','Good','Very good', 'Excellent'))
Regression1$Deferral <- factor(Regression1$Deferral, levels=c('Never','Once','More than once'))
Regression1$DonorCareer <- factor(Regression1$DonorCareer, levels=c('New','Beginner','Experienced'))
Regression1$IronSuppUse <- factor(Regression1$IronSuppUse, levels=c('No','Yes'))

# Adjust outcome variable names
names(Regression1)[names(Regression1) == "FA1_Positive"] <- "Willingness"
names(Regression1)[names(Regression1) == "FA2_Intrusive"] <- "Invasiveness"
names(Regression1)[names(Regression1) == "FA3_Conditions"] <- "Conditions"
```

# Linear Regression - Scaling
```{r}
# Create sum of all knowledge variables
Regression1$KnowledgeSum = rowSums(Regression1[ , c("KnowledgePolicy" ,"KnowledgeIronMetabolism" ,"KnowledgeIronSupplements" )], na.rm = T)

# Select and scale variables of interest
LinReg_All <- Regression1 %>% 
 # filter(Group == "Post_menopause_women") %>% 
  dplyr::select(Age, Sex, Group, Education, Health, DonorCareer, Last_donation, Collection_site, Trust, Deferral, Last_Deferral, IronSuppUse, AccountForIronLossAfterDonation,                Open_Towards_Dietary_Suppl, Willingness, Invasiveness, Conditions, KnowledgeDonation, KnowledgePolicy, KnowledgeIronMetabolism, KnowledgeIronSupplements, KnowledgeSum) %>%
  mutate(#Age = scale(Age, scale = FALSE)[,1],
         Willingness = scale(Willingness, scale = FALSE)[,1],
         Invasiveness = scale(Invasiveness, scale = FALSE)[,1],
         Conditions = scale(Conditions, scale = FALSE)[,1],
         KnowledgeDonation = scale(KnowledgeDonation, scale = FALSE)[,1],
         KnowledgePolicy = scale(KnowledgePolicy, scale = FALSE)[,1],
         KnowledgeIronMetabolism = scale(KnowledgeIronMetabolism, scale = FALSE)[,1],
         KnowledgeIronSupplements = scale(KnowledgeIronSupplements, scale = FALSE)[,1],
         KnowledgSum = scale(KnowledgeSum, scale = FALSE)[,1]) 

LinReg_All$DonorCareer <- factor(LinReg_All$DonorCareer, levels=c('New','Beginner','Experienced'))

# Create datasets with only men and only women
LinReg_All_M <- LinReg_All %>% filter(Sex == "Men")
LinReg_All_W <- LinReg_All %>% filter(Sex == "Women")
```



# Linear regression - Univariate - Complete
```{r}
# Predictors Model1
predictors <- c("KnowledgePolicy", "KnowledgeIronMetabolism", "KnowledgeIronSupplements", "Sex", "Age", "Education", "Deferral", "Trust", "DonorCareer", "IronSuppUse", "AccountForIronLossAfterDonation", "Open_Towards_Dietary_Suppl")

# WILLINGNESS #
model_summaries <- list()

for (predictor in predictors) {
  model_name <- paste0("model", predictor)
  model_summary_name <- paste0("modelsummary", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name, " <- lm(Willingness ~ ", predictor, ", data = LinReg_All)")))
  eval(parse(text = paste0(model_summary_name, "<<- tidy(", model_name, ")")))
  
  # Bereken de model samenvatting
  model_summary <- eval(parse(text = model_summary_name))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary$confint <- confint(eval(parse(text = model_name)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries[[predictor]] <- model_summary
}

# Combineer de samenvattingen in één gegevensframe
Model1_Willingness <- bind_rows(model_summaries, .id = "Predictor")

Model1_Willingness <- Model1_Willingness %>% filter(term != "(Intercept)")
Model1_Willingness <- Model1_Willingness %>% select(-Predictor)
names(Model1_Willingness)[names(Model1_Willingness) == "term"] <- "Predictor"

# Aanmaken model kolom
Model1_Willingness$Model <- "Univariate"
Model1_Willingness$Outcome <- "Willingness"

# Dataset summary
print(Model1_Willingness)



# INVASIVENESS #
model_summaries_Inv <- list()

for (predictor in predictors) {
  model_name_Inv <- paste0("model", predictor)
  model_summary_name_Inv <- paste0("modelsummary", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name_Inv, " <- lm(Invasiveness ~ ", predictor, ", data = LinReg_All)")))
  eval(parse(text = paste0(model_summary_name_Inv, "<<- tidy(", model_name_Inv, ")")))
  
  # Bereken de model samenvatting
  model_summary_Inv <- eval(parse(text = model_summary_name_Inv))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary_Inv$confint <- confint(eval(parse(text = model_name_Inv)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries_Inv[[predictor]] <- model_summary_Inv
}

# Combineer de samenvattingen in één gegevensframe
Model1_Invasiveness <- bind_rows(model_summaries_Inv, .id = "Predictor")

Model1_Invasiveness <- Model1_Invasiveness %>% filter(term != "(Intercept)")
Model1_Invasiveness <- Model1_Invasiveness%>% select(-Predictor)
names(Model1_Invasiveness)[names(Model1_Invasiveness) == "term"] <- "Predictor"

# Aanmaken model kolom
Model1_Invasiveness$Model <- "Univariate"
Model1_Invasiveness$Outcome <- "Invasiveness"

# Dataset summary
print(Model1_Invasiveness)



# CONDITIONS #
model_summaries_Con <- list()

for (predictor in predictors) {
  model_name_Con <- paste0("modelCon", predictor)
  model_summary_name_Con <- paste0("modelsummaryCon", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name_Con, " <- lm(Conditions ~ ", predictor, ", data = LinReg_All)")))
  eval(parse(text = paste0(model_summary_name_Con, "<<- tidy(", model_name_Con, ")")))
  
  # Bereken de model samenvatting
  model_summary_Con <- eval(parse(text = model_summary_name_Con))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary_Con$confint <- confint(eval(parse(text = model_name_Con)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries_Con[[predictor]] <- model_summary_Con
}

# Combineer de samenvattingen in één gegevensframe
Model1_Conditions <- bind_rows(model_summaries_Con, .id = "Predictor")

# Adjust dataset for merge
Model1_Conditions <- Model1_Conditions %>% filter(term != "(Intercept)")
Model1_Conditions <- Model1_Conditions %>% select(-Predictor)
names(Model1_Conditions)[names(Model1_Conditions) == "term"] <- "Predictor"
Model1_Conditions$Model <- "Univariate"
Model1_Conditions$Outcome <- "Conditions"

# Dataset summary
print(Model1_Conditions)
```



# Combine univariate outcomes (Willingness, Invasiveness, and Conditions)
```{r}
Model1_Complete <- bind_rows(Model1_Willingness,Model1_Invasiveness,Model1_Conditions)

# Converteer de tibble naar een dataframe
Model1_Complete <- as.data.frame(Model1_Complete)

# Add lower and higher CI
Model1_Complete <- Model1_Complete %>%
  mutate(conf.low = estimate - abs(confint) / 2, conf.high = estimate + abs(confint) / 2)
Model1_Complete <- Model1_Complete %>% select(-confint)

view(Model1_Complete)

# Save univariate outcomes
saveRDS(Model1_Complete, file.path("L:/DonorMedicin/FORTE/B Donor Perception Survey/B Analysis/R/2. Datasets/", "4A. DPS - Linear Regression - Univariate Analysis - Complete"))
```


# Linear regression - Univariate - Men
```{r}
# Predictors Model1
predictors <- c("KnowledgePolicy", "KnowledgeIronMetabolism", "KnowledgeIronSupplements", "Age", "Education", "Deferral", "Trust", "DonorCareer", "IronSuppUse", "AccountForIronLossAfterDonation", "Open_Towards_Dietary_Suppl")

# WILLINGNESS #
model_summaries <- list()

for (predictor in predictors) {
  model_name <- paste0("model", predictor)
  model_summary_name <- paste0("modelsummary", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name, " <- lm(Willingness ~ ", predictor, ", data = LinReg_All_M)")))
  eval(parse(text = paste0(model_summary_name, "<<- tidy(", model_name, ")")))
  
  # Bereken de model samenvatting
  model_summary <- eval(parse(text = model_summary_name))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary$confint <- confint(eval(parse(text = model_name)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries[[predictor]] <- model_summary
}

# Combineer de samenvattingen in één gegevensframe
Model1_Willingness_M <- bind_rows(model_summaries, .id = "Predictor")

Model1_Willingness_M <- Model1_Willingness_M %>% filter(term != "(Intercept)")
Model1_Willingness_M <- Model1_Willingness_M %>% select(-Predictor)
names(Model1_Willingness_M)[names(Model1_Willingness_M) == "term"] <- "Predictor"

# Aanmaken model kolom
Model1_Willingness_M$Model <- "Univariate"
Model1_Willingness_M$Outcome <- "Willingness"

# Dataset summary
print(Model1_Willingness_M)



# INVASIVENESS #
model_summaries_Inv <- list()

for (predictor in predictors) {
  model_name_Inv <- paste0("model", predictor)
  model_summary_name_Inv <- paste0("modelsummary", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name_Inv, " <- lm(Invasiveness ~ ", predictor, ", data = LinReg_All_M)")))
  eval(parse(text = paste0(model_summary_name_Inv, "<<- tidy(", model_name_Inv, ")")))
  
  # Bereken de model samenvatting
  model_summary_Inv <- eval(parse(text = model_summary_name_Inv))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary_Inv$confint <- confint(eval(parse(text = model_name_Inv)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries_Inv[[predictor]] <- model_summary_Inv
}

# Combineer de samenvattingen in één gegevensframe
Model1_Invasiveness_M <- bind_rows(model_summaries_Inv, .id = "Predictor")

Model1_Invasiveness_M <- Model1_Invasiveness_M %>% filter(term != "(Intercept)")
Model1_Invasiveness_M <- Model1_Invasiveness_M%>% select(-Predictor)
names(Model1_Invasiveness_M)[names(Model1_Invasiveness_M) == "term"] <- "Predictor"

# Aanmaken model kolom
Model1_Invasiveness_M$Model <- "Univariate"
Model1_Invasiveness_M$Outcome <- "Invasiveness"

# Dataset summary
print(Model1_Invasiveness_M)



# CONDITIONS #
model_summaries_Con <- list()

for (predictor in predictors) {
  model_name_Con <- paste0("modelCon", predictor)
  model_summary_name_Con <- paste0("modelsummaryCon", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name_Con, " <- lm(Conditions ~ ", predictor, ", data = LinReg_All_M)")))
  eval(parse(text = paste0(model_summary_name_Con, "<<- tidy(", model_name_Con, ")")))
  
  # Bereken de model samenvatting
  model_summary_Con <- eval(parse(text = model_summary_name_Con))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary_Con$confint <- confint(eval(parse(text = model_name_Con)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries_Con[[predictor]] <- model_summary_Con
}

# Combineer de samenvattingen in één gegevensframe
Model1_Conditions_M <- bind_rows(model_summaries_Con, .id = "Predictor")

# Adjust dataset for merge
Model1_Conditions_M <- Model1_Conditions_M %>% filter(term != "(Intercept)")
Model1_Conditions_M <- Model1_Conditions_M %>% select(-Predictor)
names(Model1_Conditions_M)[names(Model1_Conditions_M) == "term"] <- "Predictor"
Model1_Conditions_M$Model <- "Univariate"
Model1_Conditions_M$Outcome <- "Conditions"

# Dataset summary
print(Model1_Conditions_M)
```



# Combine univariate outcomes - Men
```{r}
Model1_M <- bind_rows(Model1_Willingness_M,Model1_Invasiveness_M,Model1_Conditions_M)

# Converteer de tibble naar een dataframe
Model1_M <- as.data.frame(Model1_M)

# Add lower and higher CI
Model1_M <- Model1_M %>%
  mutate(conf.low = estimate - abs(confint) / 2, conf.high = estimate + abs(confint) / 2)
Model1_M <- Model1_M %>% select(-confint)

# Add sex column
Model1_M$Sex <- "Men"

view(Model1_M)

# Save univariate outcomes
saveRDS(Model1_M, file.path("L:/DonorMedicin/FORTE/B Donor Perception Survey/B Analysis/R/2. Datasets/", "4B. DPS - Linear Regression - Univariate Analysis - Men"))
```


# Linear regression - Univariate - Women
```{r}
# Predictors Model1
predictors <- c("KnowledgePolicy", "KnowledgeIronMetabolism", "KnowledgeIronSupplements", "Age", "Education", "Deferral", "Trust", "DonorCareer", "IronSuppUse", "AccountForIronLossAfterDonation", "Open_Towards_Dietary_Suppl")

# WILLINGNESS #
model_summaries <- list()

for (predictor in predictors) {
  model_name <- paste0("model", predictor)
  model_summary_name <- paste0("modelsummary", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name, " <- lm(Willingness ~ ", predictor, ", data = LinReg_All_W)")))
  eval(parse(text = paste0(model_summary_name, "<<- tidy(", model_name, ")")))
  
  # Bereken de model samenvatting
  model_summary <- eval(parse(text = model_summary_name))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary$confint <- confint(eval(parse(text = model_name)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries[[predictor]] <- model_summary
}

# Combineer de samenvattingen in één gegevensframe
Model1_Willingness_W <- bind_rows(model_summaries, .id = "Predictor")

Model1_Willingness_W <- Model1_Willingness_W %>% filter(term != "(Intercept)")
Model1_Willingness_W <- Model1_Willingness_W %>% select(-Predictor)
names(Model1_Willingness_W)[names(Model1_Willingness_W) == "term"] <- "Predictor"

# Aanmaken model kolom
Model1_Willingness_W$Model <- "Univariate"
Model1_Willingness_W$Outcome <- "Willingness"

# Dataset summary
print(Model1_Willingness_W)



# INVASIVENESS #
model_summaries_Inv <- list()

for (predictor in predictors) {
  model_name_Inv <- paste0("model", predictor)
  model_summary_name_Inv <- paste0("modelsummary", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name_Inv, " <- lm(Invasiveness ~ ", predictor, ", data = LinReg_All_W)")))
  eval(parse(text = paste0(model_summary_name_Inv, "<<- tidy(", model_name_Inv, ")")))
  
  # Bereken de model samenvatting
  model_summary_Inv <- eval(parse(text = model_summary_name_Inv))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary_Inv$confint <- confint(eval(parse(text = model_name_Inv)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries_Inv[[predictor]] <- model_summary_Inv
}

# Combineer de samenvattingen in één gegevensframe
Model1_Invasiveness_W <- bind_rows(model_summaries_Inv, .id = "Predictor")

Model1_Invasiveness_W <- Model1_Invasiveness_W %>% filter(term != "(Intercept)")
Model1_Invasiveness_W <- Model1_Invasiveness_W%>% select(-Predictor)
names(Model1_Invasiveness_W)[names(Model1_Invasiveness_W) == "term"] <- "Predictor"

# Aanmaken model kolom
Model1_Invasiveness_W$Model <- "Univariate"
Model1_Invasiveness_W$Outcome <- "Invasiveness"

# Dataset summary
print(Model1_Invasiveness_W)



# CONDITIONS #
model_summaries_Con <- list()

for (predictor in predictors) {
  model_name_Con <- paste0("modelCon", predictor)
  model_summary_name_Con <- paste0("modelsummaryCon", predictor)
  
  # Hieronder staat je code om de modellen en samenvattingen te maken
  eval(parse(text = paste0(model_name_Con, " <- lm(Conditions ~ ", predictor, ", data = LinReg_All_W)")))
  eval(parse(text = paste0(model_summary_name_Con, "<<- tidy(", model_name_Con, ")")))
  
  # Bereken de model samenvatting
  model_summary_Con <- eval(parse(text = model_summary_name_Con))
  
  # Voeg betrouwbaarheidsintervallen toe aan de samenvatting
  model_summary_Con$confint <- confint(eval(parse(text = model_name_Con)))
  
  # Voeg de samenvatting toe aan de lijst
  model_summaries_Con[[predictor]] <- model_summary_Con
}

# Combineer de samenvattingen in één gegevensframe
Model1_Conditions_W <- bind_rows(model_summaries_Con, .id = "Predictor")

# Adjust dataset for merge
Model1_Conditions_W <- Model1_Conditions_W %>% filter(term != "(Intercept)")
Model1_Conditions_W <- Model1_Conditions_W %>% select(-Predictor)
names(Model1_Conditions_W)[names(Model1_Conditions_W) == "term"] <- "Predictor"
Model1_Conditions_W$Model <- "Univariate"
Model1_Conditions_W$Outcome <- "Conditions"

# Dataset summary
print(Model1_Conditions_W)
```

# Combine Univariate Outcomes - Women
```{r}
Model1_W <- bind_rows(Model1_Willingness_W,Model1_Invasiveness_W,Model1_Conditions_W)

# Converteer de tibble naar een dataframe
Model1_W <- as.data.frame(Model1_W)

# Add lower and higher CI
Model1_W <- Model1_W %>%
  mutate(conf.low = estimate - abs(confint) / 2, conf.high = estimate + abs(confint) / 2)
Model1_W <- Model1_W %>% select(-confint)

# Add sex column
Model1_W$Sex <- "Women"

view(Model1_W)

# Save univariate outcomes
saveRDS(Model1_W, file.path("L:/DonorMedicin/FORTE/B Donor Perception Survey/B Analysis/R/2. Datasets/", "4C. DPS - Linear Regression - Univariate Analysis - Women"))
```













# Linear regression - Multivariate - Complete
```{r}

# WILLINGNESS #
LinRegWillingness <- lm(Willingness ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Sex +
                        Age + 
                        Education +
                        Deferral +
                        Trust  +
                        DonorCareer +
                        IronSuppUse +
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegWillingness)

LinRegWillingnessCoeff <- tidy(LinRegWillingness, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv( LinRegWillingnessCoeff, file.path(FolderName, "Positive coefs.csv"))

# Adjust dataset for merge
Model2_Willingness <- as.data.frame(LinRegWillingnessCoeff)
Model2_Willingness <- Model2_Willingness %>% filter(term != "(Intercept)")
names(Model2_Willingness)[names(Model2_Willingness) == "term"] <- "Predictor"
Model2_Willingness$Model <- "Multivariate"
Model2_Willingness$Outcome <- "Willingness"

# Dataset summary
print(Model2_Willingness)

# Plot
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegPosCoeff <- read.csv(file.path(FolderName, "Positive coefs.csv"))
LinRegPosCoeff <- LinRegPosCoeff %>% filter(term != "(Intercept)")
LinRegPosCoeff <- LinRegPosCoeff %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegPosCoeff$shape <- ifelse(LinRegPosCoeff$estimate < 0 & LinRegPosCoeff$conf.high > 0, "o", "")
LinRegPosCoeff$label <- ifelse(LinRegPosCoeff$conf.low > 0 | LinRegPosCoeff$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegPosCoeff$term <- factor(LinRegPosCoeff$term, levels = LinRegPosCoeff$term)
class(LinRegPosCoeff$term)

# create ggplot
ggplot(LinRegPosCoeff, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low), xmax = conf.high), height = 0.2, width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  # Alleen cirkels aan het begin van het interval
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +  # Labels als asterisks (*) en na.rm = TRUE om missende waarden te negeren
  labs(title = "Willingness",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  theme(axis.text.y = element_text(size = 10))+
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))

FileName <- paste(FolderName, "/Willingness Regression Multivariate.png",sep="")
ggsave(FileName, width = 6, height = 4)



# INVASIVENESS #
LinRegInvasiveness <- lm(Invasiveness ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Sex +
                        Age + 
                        Education +
                        Deferral +
                        Trust  +
                        DonorCareer +
                        IronSuppUse+
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegInvasiveness)

LinRegInvasivenessCoeff <- tidy(LinRegInvasiveness, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv(LinRegInvasivenessCoeff, file.path(FolderName, "Invasive coefs.csv"))

# Adjust dataset for merge
Model2_Invasiveness <- as.data.frame(LinRegInvasivenessCoeff)
Model2_Invasiveness <- Model2_Invasiveness %>% filter(term != "(Intercept)")
names(Model2_Invasiveness)[names(Model2_Invasiveness) == "term"] <- "Predictor"
Model2_Invasiveness$Model <- "Multivariate"
Model2_Invasiveness$Outcome <- "Invasiveness"

# Plot 
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegInvCoeff <- read.csv(file.path(FolderName, "Invasive coefs.csv"))
LinRegInvCoeff <- LinRegInvCoeff %>% filter(term != "(Intercept)")
LinRegInvCoeff <- LinRegInvCoeff %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegInvCoeff$shape <- ifelse(LinRegInvCoeff$estimate < 0 & LinRegInvCoeff$conf.high > 0, "o", "")
LinRegInvCoeff$label <- ifelse(LinRegInvCoeff$conf.low > 0 | LinRegInvCoeff$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegInvCoeff$term <- factor(LinRegInvCoeff$term, levels = LinRegInvCoeff$term)
class(LinRegInvCoeff$term)

# create ggplot
ggplot(LinRegInvCoeff, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low, 0), xmax = conf.high), height = 0.2, width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +
  labs(title = "Invasiveness",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  theme(axis.text.y = element_text(size = 10))+
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))

FileName <- paste(FolderName, "/Invasiveness_regression_figure.png",sep="")
ggsave(FileName, width = 6, height = 4)



# CONDITIONS #
LinRegConditions <- lm(Conditions ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Sex +
                        Age + 
                        Education +
                        Deferral +
                        Trust  +
                        DonorCareer +
                        IronSuppUse+
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegConditions)

LinRegConditionsCoeff <- tidy(LinRegConditions, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv( LinRegConditionsCoeff, file.path(FolderName, "Conditions coefs.csv"))

# Adjust dataset for merge
Model2_Conditions <- as.data.frame(LinRegConditionsCoeff)
Model2_Conditions <- Model2_Conditions %>% filter(term != "(Intercept)")
names(Model2_Conditions)[names(Model2_Conditions) == "term"] <- "Predictor"
Model2_Conditions$Model <- "Multivariate"
Model2_Conditions$Outcome <- "Conditions"

# Plot
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegConCoeff <- read.csv(file.path(FolderName, "Conditions coefs.csv"))
LinRegConCoeff <- LinRegConCoeff %>% filter(term != "(Intercept)")
LinRegConCoeff <- LinRegConCoeff %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegConCoeff$shape <- ifelse(LinRegConCoeff$estimate < 0 & LinRegConCoeff$conf.high > 0, "o", "")
LinRegConCoeff$label <- ifelse(LinRegConCoeff$conf.low > 0 | LinRegConCoeff$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegConCoeff$term <- factor(LinRegConCoeff$term, levels = LinRegConCoeff$term)
class(LinRegConCoeff$term)

# create ggplot
ggplot(LinRegConCoeff, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low), xmax = conf.high), width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  # Alleen cirkels aan het begin van het interval
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +  
  labs(title = "Conditions",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))+
  scale_x_continuous(limits = c(-2, NA))


FileName <- paste(FolderName, "/Conditions_regression_figure.png",sep="")
ggsave(FileName, width = 6, height = 4)
```


# Regression check for normality
```{r}

autoplot(LinRegWillingness)

autoplot(LinRegInvasiveness)

autoplot(LinRegConditions)

```


# Combine multivariate outcomes - Complete
```{r}
Model2_Complete <- bind_rows(Model2_Willingness,Model2_Invasiveness,Model2_Conditions)

# Converteer de tibble naar een dataframe
Model2_Complete <- as.data.frame(Model2_Complete)

view(Model2_Complete)

# Save Multivariate outcomes
saveRDS(Model2_Complete, file.path("L:/DonorMedicin/FORTE/B Donor Perception Survey/B Analysis/R/2. Datasets/", "5A. DPS - Linear Regression - Multivariate Analysis - Complete"))
```


# Linear regression - Multivariate - Men
```{r}

# WILLINGNESS #
LinRegWillingness_M <- lm(Willingness ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Age + 
                        Education +
                        Deferral +
                        Trust  +
                        DonorCareer +
                        IronSuppUse +
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All_M, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegWillingness_M)

Model2_Willingness_M <- tidy(LinRegWillingness_M, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv(Model2_Willingness_M, file.path(FolderName, "Positive coefs Men.csv"))

# Adjust dataset for merge
Model2_Willingness_M <- as.data.frame(Model2_Willingness_M)
Model2_Willingness_M <- Model2_Willingness_M %>% filter(term != "(Intercept)")
names(Model2_Willingness_M)[names(Model2_Willingness_M) == "term"] <- "Predictor"
Model2_Willingness_M$Model <- "Multivariate"
Model2_Willingness_M$Outcome <- "Willingness"

# Dataset summary
print(Model2_Willingness_M)

# Plot
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegPosCoeff_M <- read.csv(file.path(FolderName, "Positive coefs Men.csv"))
LinRegPosCoeff_M <- LinRegPosCoeff_M %>% filter(term != "(Intercept)")
LinRegPosCoeff_M <- LinRegPosCoeff_M %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegPosCoeff_M$shape <- ifelse(LinRegPosCoeff_M$estimate < 0 & LinRegPosCoeff_M$conf.high > 0, "o", "")
LinRegPosCoeff_M$label <- ifelse(LinRegPosCoeff_M$conf.low > 0 | LinRegPosCoeff_M$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegPosCoeff_M$term <- factor(LinRegPosCoeff_M$term, levels = LinRegPosCoeff_M$term)
class(LinRegPosCoeff_M$term)

# create ggplot
ggplot(LinRegPosCoeff_M, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low), xmax = conf.high), height = 0.2, width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  # Alleen cirkels aan het begin van het interval
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +  # Labels als asterisks (*) en na.rm = TRUE om missende waarden te negeren
  labs(title = "Willingness - Men",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  theme(axis.text.y = element_text(size = 10))+
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))

FileName <- paste(FolderName, "/Willingness - Multivariate - Men.png",sep="")
ggsave(FileName, width = 6, height = 4)



# INVASIVENESS #
LinRegInvasiveness_M <- lm(Invasiveness ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Age + 
                        Education +
                        Deferral +
                        Trust +
                        DonorCareer +
                        IronSuppUse+
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All_M, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegInvasiveness_M)

LinRegInvasivenessCoeff_M <- tidy(LinRegInvasiveness_M, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv(LinRegInvasivenessCoeff_M, file.path(FolderName, "Invasive coefs Men.csv"))

# Adjust dataset for merge
Model2_Invasiveness_M <- as.data.frame(LinRegInvasivenessCoeff_M)
Model2_Invasiveness_M <- Model2_Invasiveness_M %>% filter(term != "(Intercept)")
names(Model2_Invasiveness_M)[names(Model2_Invasiveness_M) == "term"] <- "Predictor"
Model2_Invasiveness_M$Model <- "Multivariate"
Model2_Invasiveness_M$Outcome <- "Invasiveness"

# Plot 
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegInvCoeff_M <- read.csv(file.path(FolderName, "Invasive coefs Men.csv"))
LinRegInvCoeff_M <- LinRegInvCoeff_M %>% filter(term != "(Intercept)")
LinRegInvCoeff_M <- LinRegInvCoeff_M %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegInvCoeff_M$shape <- ifelse(LinRegInvCoeff_M$estimate < 0 & LinRegInvCoeff_M$conf.high > 0, "o", "")
LinRegInvCoeff_M$label <- ifelse(LinRegInvCoeff_M$conf.low > 0 | LinRegInvCoeff_M$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegInvCoeff_M$term <- factor(LinRegInvCoeff_M$term, levels = LinRegInvCoeff_M$term)
class(LinRegInvCoeff_M$term)

# create ggplot
ggplot(LinRegInvCoeff_M, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low, 0), xmax = conf.high), height = 0.2, width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +
  labs(title = "Invasiveness - Men",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  theme(axis.text.y = element_text(size = 10))+
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))

FileName <- paste(FolderName, "/Invasiveness - Multivariate - Men.png",sep="")
ggsave(FileName, width = 6, height = 4)



# CONDITIONS #
LinRegConditions_M <- lm(Conditions ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Age + 
                        Education +
                        Deferral +
                        Trust  +
                        DonorCareer +
                        IronSuppUse+
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All_M, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegConditions_M)

LinRegConditionsCoeff_M <- tidy(LinRegConditions_M, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv( LinRegConditionsCoeff_M, file.path(FolderName, "Conditions coefs Men.csv"))

# Adjust dataset for merge
Model2_Conditions_M <- as.data.frame(LinRegConditionsCoeff_M)
Model2_Conditions_M <- Model2_Conditions_M %>% filter(term != "(Intercept)")
names(Model2_Conditions_M)[names(Model2_Conditions_M) == "term"] <- "Predictor"
Model2_Conditions_M$Model <- "Multivariate"
Model2_Conditions_M$Outcome <- "Conditions"

# Plot
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegConCoeff_M <- read.csv(file.path(FolderName, "Conditions coefs Men.csv"))
LinRegConCoeff_M <- LinRegConCoeff_M %>% filter(term != "(Intercept)")
LinRegConCoeff_M <- LinRegConCoeff_M %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegConCoeff_M$shape <- ifelse(LinRegConCoeff_M$estimate < 0 & LinRegConCoeff_M$conf.high > 0, "o", "")
LinRegConCoeff_M$label <- ifelse(LinRegConCoeff_M$conf.low > 0 | LinRegConCoeff_M$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegConCoeff_M$term <- factor(LinRegConCoeff_M$term, levels = LinRegConCoeff_M$term)
class(LinRegConCoeff_M$term)

# create ggplot
ggplot(LinRegConCoeff_M, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low), xmax = conf.high), width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  # Alleen cirkels aan het begin van het interval
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +  
  labs(title = "Conditions - Men",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))+
  scale_x_continuous(limits = c(-2, NA))


FileName <- paste(FolderName, "/Conditions - Multivariate - Men.png",sep="")
ggsave(FileName, width = 6, height = 4)
```

# Combine multivariate outcomes - Men
```{r}
Model2_M <- bind_rows(Model2_Willingness_M,Model2_Invasiveness_M,Model2_Conditions_M)

# Converteer de tibble naar een dataframe
Model2_M <- as.data.frame(Model2_M)

# Add sex column
Model2_M$Sex <- "Men"

view(Model2_M)

# Save Multivariate outcomes
saveRDS(Model2_M, file.path("L:/DonorMedicin/FORTE/B Donor Perception Survey/B Analysis/R/2. Datasets/", "5B. DPS - Linear Regression - Multivariate Analysis - Men"))
```



# Linear regression - Multivariate - Women
```{r}

# WILLINGNESS #
LinRegWillingness_W <- lm(Willingness ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Age + 
                        Education +
                        Deferral +
                        Trust  +
                        DonorCareer +
                        IronSuppUse +
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All_W, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegWillingness_W)

Model2_Willingness_W <- tidy(LinRegWillingness_W, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv(Model2_Willingness_W, file.path(FolderName, "Positive coefs Women.csv"))

# Adjust dataset for merge
Model2_Willingness_W <- as.data.frame(Model2_Willingness_W)
Model2_Willingness_W <- Model2_Willingness_W %>% filter(term != "(Intercept)")
names(Model2_Willingness_W)[names(Model2_Willingness_W) == "term"] <- "Predictor"
Model2_Willingness_W$Model <- "Multivariate"
Model2_Willingness_W$Outcome <- "Willingness"

# Dataset summary
print(Model2_Willingness_W)

# Plot
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegPosCoeff_W <- read.csv(file.path(FolderName, "Positive coefs Women.csv"))
LinRegPosCoeff_W <- LinRegPosCoeff_W %>% filter(term != "(Intercept)")
LinRegPosCoeff_W <- LinRegPosCoeff_W %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegPosCoeff_W$shape <- ifelse(LinRegPosCoeff_W$estimate < 0 & LinRegPosCoeff_W$conf.high > 0, "o", "")
LinRegPosCoeff_W$label <- ifelse(LinRegPosCoeff_W$conf.low > 0 | LinRegPosCoeff_W$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegPosCoeff_W$term <- factor(LinRegPosCoeff_W$term, levels = LinRegPosCoeff_W$term)
class(LinRegPosCoeff_W$term)

# create ggplot
ggplot(LinRegPosCoeff_W, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low), xmax = conf.high), height = 0.2, width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  # Alleen cirkels aan het begin van het interval
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +  # Labels als asterisks (*) en na.rm = TRUE om missende waarden te negeren
  labs(title = "Willingness - Women",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  theme(axis.text.y = element_text(size = 10))+
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))

FileName <- paste(FolderName, "/Willingness - Multivariate - Women.png",sep="")
ggsave(FileName, width = 6, height = 4)



# INVASIVENESS #
LinRegInvasiveness_W <- lm(Invasiveness ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Age + 
                        Education +
                        Deferral +
                        Trust  +
                        DonorCareer +
                        IronSuppUse+
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All_W, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegInvasiveness_W)

LinRegInvasivenessCoeff_W <- tidy(LinRegInvasiveness_W, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv(LinRegInvasivenessCoeff_W, file.path(FolderName, "Invasive coefs Women.csv"))

# Adjust dataset for merge
Model2_Invasiveness_W <- as.data.frame(LinRegInvasivenessCoeff_W)
Model2_Invasiveness_W <- Model2_Invasiveness_W %>% filter(term != "(Intercept)")
names(Model2_Invasiveness_W)[names(Model2_Invasiveness_W) == "term"] <- "Predictor"
Model2_Invasiveness_W$Model <- "Multivariate"
Model2_Invasiveness_W$Outcome <- "Invasiveness"

# Plot 
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegInvCoeff_W <- read.csv(file.path(FolderName, "Invasive coefs Women.csv"))
LinRegInvCoeff_W <- LinRegInvCoeff_W %>% filter(term != "(Intercept)")
LinRegInvCoeff_W <- LinRegInvCoeff_W %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegInvCoeff_W$shape <- ifelse(LinRegInvCoeff_W$estimate < 0 & LinRegInvCoeff_W$conf.high > 0, "o", "")
LinRegInvCoeff_W$label <- ifelse(LinRegInvCoeff_W$conf.low > 0 | LinRegInvCoeff_W$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegInvCoeff_W$term <- factor(LinRegInvCoeff_W$term, levels = LinRegInvCoeff_W$term)
class(LinRegInvCoeff_W$term)

# create ggplot
ggplot(LinRegInvCoeff_W, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low, 0), xmax = conf.high), height = 0.2, width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +
  labs(title = "Invasiveness - Women",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  theme(axis.text.y = element_text(size = 10))+
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))

FileName <- paste(FolderName, "/Invasiveness - Multivariate - Women.png",sep="")
ggsave(FileName, width = 6, height = 4)



# CONDITIONS #
LinRegConditions_W <- lm(Conditions ~ 
                        KnowledgePolicy +
                        KnowledgeIronMetabolism +
                        KnowledgeIronSupplements +
                        Age + 
                        Education +
                        Deferral +
                        Trust  +
                        DonorCareer +
                        IronSuppUse+
                        AccountForIronLossAfterDonation +
                        Open_Towards_Dietary_Suppl,
                      data = LinReg_All_W, 
                      #family = bernoulli(),
                      #file = file, 
                      cores = 4,
                      iter= 10000
)

summary(LinRegConditions_W)

LinRegConditionsCoeff_W <- tidy(LinRegConditions_W, conf.int = TRUE, conf.level = 0.95, exponentiate = FALSE)
write.csv( LinRegConditionsCoeff_W, file.path(FolderName, "Conditions coefs Women.csv"))

# Adjust dataset for merge
Model2_Conditions_W <- as.data.frame(LinRegConditionsCoeff_W)
Model2_Conditions_W <- Model2_Conditions_W %>% filter(term != "(Intercept)")
names(Model2_Conditions_W)[names(Model2_Conditions_W) == "term"] <- "Predictor"
Model2_Conditions_W$Model <- "Multivariate"
Model2_Conditions_W$Outcome <- "Conditions"

# Plot
# Lees de coëfficiënten en confidence-intervallen in van het CSV-bestand
LinRegConCoeff_W <- read.csv(file.path(FolderName, "Conditions coefs Women.csv"))
LinRegConCoeff_W <- LinRegConCoeff_W %>% filter(term != "(Intercept)")
LinRegConCoeff_W <- LinRegConCoeff_W %>% arrange(desc(estimate))

# Bepaal welke punten cirkels moeten zijn (begin van het interval)
LinRegConCoeff_W$shape <- ifelse(LinRegConCoeff_W$estimate < 0 & LinRegConCoeff_W$conf.high > 0, "o", "")
LinRegConCoeff_W$label <- ifelse(LinRegConCoeff_W$conf.low > 0 | LinRegConCoeff_W$conf.high < 0, "*", NA)

# Converteer de 'term'-kolom naar een factor met de aangepaste volgorde
LinRegConCoeff_W$term <- factor(LinRegConCoeff_W$term, levels = LinRegConCoeff_W$term)
class(LinRegConCoeff_W$term)

# create ggplot
ggplot(LinRegConCoeff_W, aes(x = estimate, y = term)) +
  geom_errorbar(aes(xmin = pmin(conf.low), xmax = conf.high), width = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  
  geom_point(size = 3) +  # Alleen cirkels aan het begin van het interval
  geom_text(aes(label = label), hjust = -0.5, vjust = 0, size = 5, na.rm = TRUE) +  
  labs(title = "Conditions - Women",
       y = "Variabele",
       x = "Coëfficiënt") +
  theme_classic() +
  scale_y_discrete(expand = expansion(add = c(0.5, 0.8)))+
  scale_x_continuous(limits = c(-2, NA))


FileName <- paste(FolderName, "/Conditions - Multivariate - Women.png",sep="")
ggsave(FileName, width = 6, height = 4)
```

# Combine multivariate outcomes - Women
```{r}
Model2_W <- bind_rows(Model2_Willingness_W,Model2_Invasiveness_W,Model2_Conditions_W)

# Converteer de tibble naar een dataframe
Model2_W <- as.data.frame(Model2_W)

# Add sex column
Model2_W$Sex <- "Women"

view(Model2_W)

# Save Multivariate outcomes
saveRDS(Model2_W, file.path("L:/DonorMedicin/FORTE/B Donor Perception Survey/B Analysis/R/2. Datasets/", "5C. DPS - Linear Regression - Multivariate Analysis - Women"))
```




